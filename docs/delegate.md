# Делегаты

Делегаты в фреймворке ФИНТ позволяют создавать ссылки на методы объектов, реализуя механизм указателей на функции. Это достигается через автоматическую генерацию специальных методов с суффиксом "Ссылка" (например, `МойМетодСсылка`), которые возвращают объект класса `Действие`. Объект `Действие` инкапсулирует экземпляр объекта и имя метода, обеспечивая отложенный вызов с сохранением контекста. Делегаты поддерживают полиморфизм: в случае наследования вызывается реализация из дочернего класса.

## Введение

Делегаты заменяют лямбда-выражения или анонимные функции в среде строгой типизации OneScript, позволяя передавать поведение методов как параметры или хранить в свойствах. Они генерируются автоматически для всех экспортных методов классов во время инициализации фреймворка.

**Преимущества:**
- Типобезопасность: Проверки типов параметров и возвращаемого значения на этапе выполнения.
- Интеграция с ООП: Поддержка наследования и полиморфизма — делегаты от базового класса могут вызывать переопределенные методы в наследниках.
- Гибкость: Передача методов в коллекции, использование в обработчиках событий.

Связанные механизмы: [Интерфейсы](interfaces.md) для контрактов методов, [Методы](methods.md) для объявления экспортных процедур/функций.

## Использование

1. **Создание ссылки:** Вызовите метод `ИмяМетодаСсылка()` на экземпляре объекта. Возвращается объект `Действие`.
2. **Выполнение:** Для процедур — `Действие.Выполнить(параметры...)`; для функций — `Результат = Действие.Выполнить(параметры...)`.
3. **Передача:** Делегаты можно хранить в свойствах (`&Действие Обработчик;`), передавать в методы или коллекции.
4. **Проверки типов:** Фреймворк проверяет соответствие типов параметров и возвращаемого значения.

**Методы объекта `Действие`:**

| Метод     | Параметры          | Возврат          | Описание |
|-----------|--------------------|------------------|----------|
| Выполнить | Аргументы метода  | Результат (для функций) | Выполняет оригинальный метод с переданными аргументами. Для процедур — без возврата. |

**Примечание:** Делегаты привязаны к экземпляру объекта (`ЭтотОбъект`), поэтому полиморфизм достигается через наследование.

## Примеры

### Простой пример: Делегат для процедуры

В классе `ВходящийЗапрос` (из `fint_web`) объявлен экспортный метод `ВызовПроцедурыИзДелегата`. Фреймворк генерирует `ВызовПроцедурыИзДелегатаСсылка`.

```bsl
ОбъектВходящегоЗапроса = ВходящийЗапрос.Создать();  // Создание экземпляра
Действие = ОбъектВходящегоЗапроса.ВызовПроцедурыИзДелегатаСсылка();  // Получение делегата
Действие.Выполнить("Привет из корня");  // Вызов: выводит сообщение через оригинальный метод
```

### Пример: Делегат для функции

Аналогично для функции `ВызовФункцииИзДелегата` (возвращает строку).

```bsl
ТекстИзДелегата = ОбъектВходящегоЗапроса.ВызовФункцииИзДелегатаСсылка().Выполнить();  // Вызов без параметров, результат в переменную
Сообщить(ТекстИзДелегата);  // Вывод: строка от оригинального метода
```

## Ограничения

- **Только экспортные методы:** Делегаты генерируются исключительно для публичных (`Экспорт`) методов. Неэкспортные игнорируются.
- **Привязка к экземпляру:** Делегат работает только с конкретным объектом. Хранение ссылки на уничтоженный объект приведет к ошибке выполнения.
- **Типизация:** Параметры и возвращаемое значение проверяются динамически. Несоответствие вызовет исключение.
- **Производительность:** Генерация и вызов через `Действие` добавляют overhead; используйте для динамических сценариев, не для hot paths.

> **Предупреждение:** Избегайте циклических ссылок с делегатами — может привести к утечкам памяти.
